@model List<ConquerSite.Models.MiningModels>

@{
    ViewData["Title"] = "Mercado de Itens";
}

<div class="market-container">
    <h1 class="title">🎮 Mercado de <span>Itens</span> 💎</h1>

    <!-- Filtros -->
    <div class="filters">
        <input type="text" id="searchPlayer" class="filter-input" placeholder="🔍 Buscar Jogador">
        <input type="text" id="searchItem" class="filter-input" placeholder="🗡️ Buscar Item">
        <button id="btnClear" class="btn-clear">❌ Limpar Filtros</button>
    </div>

    <!-- Tabela -->
    <div class="table-container">
        <table class="market-table">
            <thead>
                <tr>
                    <th>👤 Jogador</th>
                    <th>🗡️ Gem</th>
                    <th>💰 Time</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var item in Model)
                {
                    <tr class="market-item">
                        <td>@item.player_name</td>
                        <td>@item.item_name</td>
                        <td>@item.mined_at.ToString("dd/MM/yyyy HH:mm")</td>
                    </tr>
                }
            </tbody>
        </table>
    </div>

    <p class="item-count">Exibindo <span id="itemCount">@Model.Count</span> itens</p>
</div>

@section Scripts {
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const searchPlayer = document.getElementById('searchPlayer');
            const searchItem = document.getElementById('searchItem');
            const btnClear = document.getElementById('btnClear');
            const itemCount = document.getElementById('itemCount');
            const rows = document.querySelectorAll('.market-item');

            function filterTable() {
                const playerFilter = searchPlayer.value.toLowerCase();
                const itemFilter = searchItem.value.toLowerCase();
                const priceFilter = searchPrice.value;
                let visibleCount = 0;

                rows.forEach(row => {
                    const player = row.cells[0].textContent.toLowerCase();
                    const item = row.cells[1].textContent.toLowerCase();
                    const price = row.cells[2].textContent.replace(' CPS', '').replace(/,/g, '');

                    const matchPlayer = player.includes(playerFilter);
                    const matchItem = item.includes(itemFilter);
                    const matchPrice = !priceFilter || price.includes(priceFilter);

                    if (matchPlayer && matchItem && matchPrice) {
                        row.style.display = '';
                        visibleCount++;
                    } else {
                        row.style.display = 'none';
                    }
                });

                itemCount.textContent = visibleCount;
            }

            searchPlayer.addEventListener('input', filterTable);
            searchItem.addEventListener('input', filterTable);
            searchPrice.addEventListener('input', filterTable);
            btnClear.addEventListener('click', function() {
                searchPlayer.value = '';
                searchItem.value = '';
                searchPrice.value = '';
                rows.forEach(row => row.style.display = '');
                itemCount.textContent = rows.length;
            });
        });
    </script>
}
